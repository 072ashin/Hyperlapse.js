<!DOCTYPE html>
<html> 
<head> 
   <meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
   <title>Basic</title> 

   <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false" type="text/javascript"></script> 
   <script src="js/dat.gui.min.js"></script>
   <script src="js/GSVPano.js"></script>
   <script src="js/Three.js"></script>
   <script src="js/RequestAnimationFrame.js"></script>
   <script src="../src/Hyperlapse.js"></script>
   <script> 
   
      var start_point = new google.maps.LatLng(44.3431,6.783936);
      var end_point = new google.maps.LatLng(44.340578,6.782684);
      var lookat_point = new google.maps.LatLng(44.344875,6.790581);
      var map, pin, pivot, directions_renderer;

      function init() {

         /* Map */

         var mapOpt = { 
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            center: start_point,
            zoom: 15
         };

         map = new google.maps.Map(document.getElementById("map"), mapOpt);

         directions_renderer = new google.maps.DirectionsRenderer({draggable:true, polylineOptions:{geodesic: false}});
         directions_renderer.setMap(map);
         directions_renderer.setOptions({preserveViewport:true});

         pin = new google.maps.Marker({
            position: start_point,
            map: map
         });

         pivot = new google.maps.Marker({
            position: lookat_point,
            draggable: true,
            map: map
         });

         google.maps.event.addListener (pivot, 'drag', function (event) {
            hyperlapse.setLookat( pivot.getPosition() );
         });


         /* Hyperlapse */

         var hyperlapse = new Hyperlapse(document.getElementById('pano'), map, {
            start: start_point, 
            end: end_point,
            lookat: lookat_point,
            interval: 50,
            distance: 10
         });
         
         hyperlapse.addListener({'onRoute': function(e){
            console.log(e.response);
            directions_renderer.setDirections(e.response);
         }});

         hyperlapse.addListener({'onLoadProgress': function(e){
            console.log(e.position +" "+ hyperlapse.length());
         }});

         hyperlapse.addListener({'onLoadComplete': function(e){
            console.log("load complete");
         }});

         hyperlapse.addListener({'onFrame': function(e){
            pin.setPosition(e.point);
         }});

         hyperlapse.generate();

         var gui = new dat.GUI();

         var o = {elevation_offset:0, tilt:0};
         var pitch_control = gui.add(o, 'elevation_offset', -500, 500);
         pitch_control.onChange(function(value) {
            hyperlapse.elevation_offset = value;
         });

         var tilt_control = gui.add(o, 'tilt', -Math.PI/2, Math.PI/2);
         tilt_control.onChange(function(value) {
            hyperlapse.tilt = value;
         });

         gui.add(hyperlapse, 'play');
         gui.add(hyperlapse, 'pause');
      }

      window.onload = init;
   </script> 
</head> 
<body> 
   <div id="pano" ></div>
   <div id="map" style="width: 600px; height: 400px"></div>
</body> 
</html>